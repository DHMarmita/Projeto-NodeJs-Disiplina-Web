<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div id="login-form"> 
        <input id="userEmail" type="email" placeholder="Enter Email" value=""/>
        <input id="userPassword" type="password" placeholder="Enter Password" value=""/>
        <input id="login_btn" type="submit" value="Login" onClick="login();"/> 
    </div>
    
    <div id="overlay"> 
        <h1> Digite um Objeto e Retorne um Emoji</h1>
        <input type="text" name="search" value=""class="name">
        <button type="submit">Buscar</button>
        <p><span>Emoji: </span> <span class="result"></span></p>
    </div>

    <script type="text/javascript">
        function login(){
            var email = document.getElementById('userEmail'),
                password = document.getElementById('userPassword');
            if(password.value == '' || password.value == null || email.value.length <= 3 || email.value == null || email.value == ''){
                alert('Credenciais Invalida');
            }else{
                post_login(document.getElementById('userEmail').value, document.getElementById('userPassword').value);
            }
        }
        function post_login(login, password){
            var xhttp = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP");
            xhttp.open("POST","https://reqres.in/api/login",true);
            xhttp.setRequestHeader("Content-type", "application/json");
            xhttp.send(JSON.stringify({"email": login,"password": password}));
            xhttp.onreadystatechange = function(){
                    if (this.readyState == 4 && this.status == 200){
                        var token = (JSON.parse(this.responseText).token);
                        localStorage.setItem("token",token);
                        authenticate();
                    }
                }
        }
        function authenticate(){
            if (localStorage.getItem('token') != null && localStorage.getItem('token') != "undefined"){
                document.getElementById('overlay').style.display = 'block';
            }else{
                document.getElementById('overlay').style.display = 'none';
            }
        }
        document.querySelector('button').addEventListener('click',function(){
            var search = document.querySelector(".name"),
                result = document.querySelector('.result');
            function show_emoji(info){
                var obj_info = JSON.parse(info);
                result.innerHTML = obj_info?.at(0)?.character;
            }
            function get_emoji(callback, search){
                var xhttp = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP")
                xhttp.onreadystatechange = function(){
                    if (this.readyState == 4 && this.status == 200){
                        callback(this.responseText);
                    }
                }
            xhttp.open("GET", "https://emoji-api.com/emojis/"+ search?.value?.replace(/ /g, "-") +"?access_key=58a2a558d9009d1abd2f119452849f7466f29fda");
            xhttp.send();
        }
        get_emoji(show_emoji, search);
        });
        authenticate();
    </script>
</body>
</html>